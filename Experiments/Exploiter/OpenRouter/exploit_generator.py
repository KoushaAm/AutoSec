import requests
import os 
from dotenv import load_dotenv
from utils.models import *
from utils.system_prompts import *
from openai import OpenAI



def initialize():
    load_dotenv()
    model = LLAMA3 # title for deepseek model for openrouter
    client = OpenAI(
        base_url="https://openrouter.ai/api/v1",
        api_key= os.getenv("OPEN_ROUTER_API_KEY")
    )

    return client, model

def generate(client, model, prompt) : 
    completion = client.chat.completions.create(
  
    model=model,
    messages=[
        {
        "role": "user",
        "content": prompt
        }
    ]
    )

    return completion.choices[0].message.content


client, model = initialize()

# print(generate(client, model))
prompt = get_sys_prompt("project_cmd_2/Main.java")
output = generate(client, model, prompt)
output_path = "project_cmd_2/Test.java"

output_cleaned = output.strip().replace("```java", "").replace("```", "")

with open(output_path, "w") as java_file:
    java_file.write(output_cleaned)

print(f"JUnit test written to: {output_path}")