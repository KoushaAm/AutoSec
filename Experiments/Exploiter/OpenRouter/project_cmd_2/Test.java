
import org.junit.jupiter.api.AfterEach;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import java.io.*;
import java.util.Scanner;

public class CommandInjectionTest {

    private Main main;
    private ByteArrayOutputStream outputStream;
    private PrintStream originalOut;

    @BeforeEach
    void setUp() {
        main = new Main();
        outputStream = new ByteArrayOutputStream();
        originalOut = System.out;
        System.setOut(new PrintStream(outputStream));
    }

    @AfterEach
    void tearDown() {
        System.setOut(originalOut);
    }

    @Test
    void testCommandInjection() throws IOException {
        String[] payloads = {
            "; echo 'Command injection successful';",
            "& echo 'Command injection successful';",
            "| echo 'Command injection successful';",
            "`echo 'Command injection successful;'`",
            "; ls -l;",
            "& ls -l;",
            "| ls -l;",
            "`ls -l`"
        };

        for (String payload : payloads) {
            testCommandInjectionPayload(payload);
        }
    }

    private void testCommandInjectionPayload(String payload) throws IOException {
        Scanner scanner = new Scanner(System.in);
        System.setIn(new ByteArrayInputStream((
            "6\n" + 
            payload + 
            "\n" + 
            "7"
        ).getBytes()));

        main.startMenu();

        String output = outputStream.toString();
        boolean exploitationSuccessful = output.contains("Command injection successful") || output.contains("total");

        writeReport(payload, exploitationSuccessful);
    }

    private void writeReport(String payload, boolean exploitationSuccessful) throws IOException {
        try (FileWriter writer = new FileWriter("report.txt", true)) {
            writer.write("Payload: " + payload + "\n");
            writer.write("Exploitation successful: " + (exploitationSuccessful ? "YES" : "NO") + "\n\n");
        }
    }
}
