import requests
import os
import sys_prompt
import openai

def get_token(filename) -> str:
    with open(filename, "r") as file:
        return file.read().strip()
    


API_URL = "https://router.huggingface.co/featherless-ai/v1/completions"
headers = {
    "Authorization": f"Bearer {get_token('token.txt')}",
    "Content-Type": "application/json"
}




def ask_question(question: str):
    payload = {
        "model": "mistralai/Mistral-7B-Instruct-v0.2",
        "prompt": f"Question: {question}\nAnswer:",
        "max_tokens": 2500,
        "temperature": 0.7,
        "top_p": 0.9
    }
    response = requests.post(API_URL, headers=headers, json=payload)
    response.raise_for_status()
    return response.json()

def ask_gpt(question: str) -> str:
    openai.api_key = get_token("openai.txt")
    print(get_token("openai.txt"))
    response = openai.Completion.create(
        model="gpt-4o-mini",
        prompt=f"Question: {question}\nAnswer:",
        max_tokens=2500,
        temperature=0.7,
        top_p=0.9
    )
    return response.choices[0].text.strip()

def read_source_code(file_path: str) -> str:
    try:
        with open(file_path, "r") as file:
            return file.read()
    except Exception as e:
        print(f"Error reading file {file_path}: {e}")
        return ""

if __name__ == "__main__":
    
    question = sys_prompt.get_sys_prompt()
    # ask_gpt(question)
    ask_question(question)
    
    raw_output = ask_question(question)
    
    with open("raw_output.txt", "w") as f:
        f.write(str(raw_output))
    
    text_output = raw_output["choices"][0]["text"]
    text_output = text_output.replace("```python", "").replace("```", "").strip()
    
    with open("exploit.py", "w") as f:
        f.write(text_output)
    
    print("Exploit script generated: exploit.py")