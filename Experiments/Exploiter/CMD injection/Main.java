package exploiter.sandbox;

import java.io.IOException;
import java.io.InputStream;
import java.nio.charset.StandardCharsets;
import java.util.Scanner;

public class Main {
    public static void main(String[] args) throws IOException, InterruptedException {
        if (args.length == 0) {
            System.out.println("Usage: java Main <input>");
            return;
        }
        String userInput = args[0];

        // Build an array so the shell receives the entire command as one argument to -c
        String[] cmd = { "/bin/sh", "-c", "ls " + userInput + " ; touch target/testfile" };
        System.out.println("Executed: /bin/sh -c " + "\"ls " + userInput + " ; touch target/testfile\"");

        Process proc = new ProcessBuilder(cmd).start();

        // capture stdout/stderr (helpful for debugging)
        String out = streamToString(proc.getInputStream());
        String err = streamToString(proc.getErrorStream());

        int rc = proc.waitFor();
        System.out.println("exit=" + rc);
        if (!out.isEmpty())  System.out.println("STDOUT:\n" + out);
        if (!err.isEmpty())  System.err.println("STDERR:\n" + err);
    }

    private static String streamToString(InputStream is) {
        try (Scanner s = new Scanner(is, StandardCharsets.UTF_8.name())) {
            s.useDelimiter("\\A");
            return s.hasNext() ? s.next() : "";
        }
    }
}
