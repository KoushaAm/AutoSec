# ---- Spark (spark-core 2.7.1) test runner ----
# POM wants Java 8 (java.version=1.8) and uses Maven plugins compatible with it.
FROM maven:3.6.3-jdk-8

WORKDIR /workspace

# 1) Copy only Maven metadata first (better layer caching)
COPY pom.xml ./

# 2) Pre-download dependencies (works even without sources)
RUN mvn -q -e -DskipTests dependency:go-offline

# 3) Copy the rest of the project
COPY . .

# 4) Run tests by default
# You can override with: docker run ... mvn -Dtest=... test
CMD ["mvn", "-q", "-e", "test"]
