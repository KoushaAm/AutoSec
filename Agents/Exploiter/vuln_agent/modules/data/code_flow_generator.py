import json
from pathlib import Path

# this helper function extracts the results.json from Finder and passes on the first code flow the Exploiter
def get_code_flow(filename: str | Path | None = None):
    if filename is None:
        filename = Path(__file__).parent / "raw" / "result.json"
    else:
        filename = Path(filename)

        # If caller accidentally passes a directory, assume raw/result.json under it
    if filename.is_dir():
        filename = filename / "raw" / "result.json"

    if not filename.exists():
        raise FileNotFoundError(f"SARIF code flow file not found: {filename}")

    with open(filename, "r", encoding="utf-8") as f:
        data = json.load(f)

    for key, value in data["runs"][0]["results"][0].items():
        print(key)

    data = data["runs"][0]["results"]

    res = []
    for i in range(len(data)):
        res.append(data[i]["codeFlows"])

    # return the first full code flow
    for item in res:
        if item:
            return item
    else:
        return None

# print(get_code_flow())


